import { combineReducers, createStore, applyMiddleware } from 'redux';
import axios from 'axios';
import thunk from 'redux-thunk'


    //////////////////////////////////////////////////////////////////////////
    /////////////////////////REDUX - ACTION TYPES/////////////////////////////
    //////////////////////////////////////////////////////////////////////////

    /////////////////////////PRODUCTS - ACTION TYPES//////////////////////////
    const SET_PRODUCTS = 'SET_PRODUCTS'



    ///////////////////////////////////////////////////////////////////////////
    ////////////////////////REDUX - ACTION CREATORS////////////////////////////
    ///////////////////////////////////////////////////////////////////////////

    /////////////////////////PRODUCT ACTION CREATORS//////////////////////////
    const setProductsAction = (products) => ({type: SET_PRODUCTS, products})





    ///////////////////////////////////////////////////////////////////////////
    ////////////////////////     REDUX - THUNKS    ////////////////////////////
    ///////////////////////////////////////////////////////////////////////////

    ////////////////////////     PRODUCT - THUNKS    //////////////////////////


    const setProductsThunk = () => {
      return async dispatch => {
        const allProducts = (await axios.get('/api/products')).data;
        dispatch(setProductsAction(allProducts))
      }
    }



    ///////////////////////////////////////////////////////////////////////////
    ////////////////////////     REDUX - REDUCERS    //////////////////////////
    ///////////////////////////////////////////////////////////////////////////


    ////////////////////////   REDUX - PRODUCTS REDUCER   ////////////////////

    const productReducer = (state = [], action) => {
      if (action.type === SET_PRODUCTS) {
          state = action.products;
      }
      return state;
    }



    ////////////////////////   REDUX - COMBINE REDUCERS    ////////////////////
    const reducer = combineReducers({
      products: productReducer
    });



    //////////////////////////////////////////////////////////////////////////
    ////////////////////////  REDUX - CREATE STORE  ///////////////////////////
    ///////////////////////////////////////////////////////////////////////////


      //REDUX STORE WITH MIDDLEWARE
      const store = createStore(reducer, applyMiddleware(thunk));


      export default store;
      export { setProductsAction };
      export { setProductsThunk };
